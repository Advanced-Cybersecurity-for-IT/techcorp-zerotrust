# ============================================================================
# TECHCORP ZERO TRUST - REGOLE SNORT IDS
# ============================================================================
# Regole di rilevamento personalizzate per la Zero Trust Architecture
# ============================================================================

# ============================================================================
# RILEVAMENTO SQL INJECTION
# ============================================================================
# UNION-based SQL injection
alert tcp any any -> any any (msg:"SQLI-001 SQL Injection - UNION SELECT"; content:"union"; nocase; content:"select"; nocase; distance:0; within:20; classtype:web-application-attack; sid:1000001; rev:3;)

# Boolean-based SQL injection
alert tcp any any -> any any (msg:"SQLI-002 SQL Injection - OR 1=1"; content:"or"; nocase; pcre:"/or\s+[\x27\x22]?\d+[\x27\x22]?\s*=\s*[\x27\x22]?\d+/i"; classtype:web-application-attack; sid:1000002; rev:3;)

# SQL comment injection
alert tcp any any -> any any (msg:"SQLI-003 SQL Injection - Comment"; content:"--"; classtype:web-application-attack; sid:1000003; rev:3;)

# Time-based blind SQL injection
alert tcp any any -> any any (msg:"SQLI-004 SQL Injection - SLEEP"; content:"sleep"; nocase; content:"("; distance:0; within:5; classtype:web-application-attack; sid:1000004; rev:2;)

# Injection WAITFOR DELAY
alert tcp any any -> any any (msg:"SQLI-005 SQL Injection - WAITFOR"; content:"waitfor"; nocase; content:"delay"; nocase; distance:0; within:15; classtype:web-application-attack; sid:1000005; rev:2;)

# Injection DROP TABLE
alert tcp any any -> any any (msg:"SQLI-006 SQL Injection - DROP TABLE"; content:"drop"; nocase; content:"table"; nocase; distance:0; within:15; classtype:web-application-attack; sid:1000006; rev:2;)

# Injection INSERT INTO
alert tcp any any -> any any (msg:"SQLI-007 SQL Injection - INSERT INTO"; content:"insert"; nocase; content:"into"; nocase; distance:0; within:15; classtype:web-application-attack; sid:1000007; rev:2;)

# ============================================================================
# RILEVAMENTO CROSS-SITE SCRIPTING (XSS)
# ============================================================================
# Injection tag Script
alert tcp any any -> any any (msg:"XSS-001 Cross-Site Scripting - Script Tag"; content:"<script"; nocase; classtype:web-application-attack; sid:1000010; rev:3;)

# Injection Event handler - onerror
alert tcp any any -> any any (msg:"XSS-002 Cross-Site Scripting - onerror"; content:"onerror"; nocase; content:"="; distance:0; within:5; classtype:web-application-attack; sid:1000011; rev:3;)

# Injection Event handler - onload
alert tcp any any -> any any (msg:"XSS-003 Cross-Site Scripting - onload"; content:"onload"; nocase; content:"="; distance:0; within:5; classtype:web-application-attack; sid:1000012; rev:2;)

# Injection Event handler - onclick
alert tcp any any -> any any (msg:"XSS-004 Cross-Site Scripting - onclick"; content:"onclick"; nocase; content:"="; distance:0; within:5; classtype:web-application-attack; sid:1000013; rev:2;)

# Gestore protocollo JavaScript
alert tcp any any -> any any (msg:"XSS-005 Cross-Site Scripting - javascript:"; content:"javascript"; nocase; content:":"; distance:0; within:3; classtype:web-application-attack; sid:1000014; rev:2;)

# ============================================================================
# RILEVAMENTO PATH TRAVERSAL
# ============================================================================
# Directory traversal - ../
alert tcp any any -> any any (msg:"TRAV-001 Path Traversal - Dot Dot Slash"; content:"../"; classtype:web-application-attack; sid:1000020; rev:3;)

# Directory traversal - encoded %2e%2e
alert tcp any any -> any any (msg:"TRAV-002 Path Traversal - URL Encoded"; content:"%2e%2e"; nocase; classtype:web-application-attack; sid:1000021; rev:3;)

# Directory traversal - backslash
alert tcp any any -> any any (msg:"TRAV-003 Path Traversal - Backslash"; content:"..\\"; classtype:web-application-attack; sid:1000022; rev:2;)

# ============================================================================
# RILEVAMENTO COMMAND INJECTION
# ============================================================================
# Shell command - pipe to shell
alert tcp any any -> any any (msg:"CMD-001 Command Injection - Pipe"; content:"|7C|"; content:"sh"; distance:0; within:10; classtype:web-application-attack; sid:1000030; rev:4;)

# Shell command - backtick execution
alert tcp any any -> any any (msg:"CMD-002 Command Injection - Backtick"; content:"|60|"; classtype:web-application-attack; sid:1000031; rev:4;)

# Shell command - semicolon cat
alert tcp any any -> any any (msg:"CMD-003 Command Injection - cat"; content:"|3B|"; content:"cat"; distance:0; within:10; classtype:web-application-attack; sid:1000032; rev:3;)

# Shell command - semicolon ls
alert tcp any any -> any any (msg:"CMD-004 Command Injection - ls"; content:"|3B|"; content:"ls"; distance:0; within:10; classtype:web-application-attack; sid:1000033; rev:3;)

# Shell command - download wget
alert tcp any any -> any any (msg:"CMD-005 Command Injection - wget"; content:"wget"; nocase; classtype:web-application-attack; sid:1000034; rev:2;)

# Shell command - download curl
alert tcp any any -> any any (msg:"CMD-006 Command Injection - curl command"; content:"|3B|"; content:"curl"; distance:0; within:10; classtype:web-application-attack; sid:1000035; rev:3;)

# ============================================================================
# RILEVAMENTO RECONNAISSANCE / SCANNER
# ============================================================================
# Scanner Nikto
alert tcp any any -> any any (msg:"SCAN-001 Scanner - Nikto"; content:"Nikto"; nocase; classtype:web-application-activity; sid:1000040; rev:3;)

# Scanner SQLMap
alert tcp any any -> any any (msg:"SCAN-002 Scanner - SQLMap"; content:"sqlmap"; nocase; classtype:web-application-activity; sid:1000041; rev:3;)

# Scanner Nmap
alert tcp any any -> any any (msg:"SCAN-003 Scanner - Nmap"; content:"Nmap"; nocase; classtype:web-application-activity; sid:1000042; rev:3;)

# Scanner Acunetix
alert tcp any any -> any any (msg:"SCAN-004 Scanner - Acunetix"; content:"Acunetix"; nocase; classtype:web-application-activity; sid:1000043; rev:2;)

# Burp Suite
alert tcp any any -> any any (msg:"SCAN-005 Scanner - Burp Suite"; content:"Burp"; nocase; classtype:web-application-activity; sid:1000044; rev:2;)

# ============================================================================
# ACCESSO A FILE SENSIBILI
# ============================================================================
# Accesso /etc/passwd
alert tcp any any -> any any (msg:"FILE-001 Sensitive File - /etc/passwd"; content:"/etc/passwd"; classtype:web-application-attack; sid:1000050; rev:3;)

# Accesso /etc/shadow
alert tcp any any -> any any (msg:"FILE-002 Sensitive File - /etc/shadow"; content:"/etc/shadow"; classtype:web-application-attack; sid:1000051; rev:3;)

# Accesso .htaccess
alert tcp any any -> any any (msg:"FILE-003 Sensitive File - .htaccess"; content:".htaccess"; classtype:web-application-attack; sid:1000052; rev:3;)

# Accesso web.config
alert tcp any any -> any any (msg:"FILE-004 Sensitive File - web.config"; content:"web.config"; nocase; classtype:web-application-attack; sid:1000053; rev:2;)

# ============================================================================
# RETE TECHCORP - IP BLOCCATI
# ============================================================================
# Alert su traffico da host esterno bloccato
alert ip 172.28.1.200 any -> any any (msg:"BLOCKED-001 Traffic from Blocked External Host"; classtype:policy-violation; sid:1000100; rev:2;)

# Alert su traffico da host malevolo
alert ip 172.28.1.250 any -> any any (msg:"BLOCKED-002 Traffic from Malicious Host"; classtype:policy-violation; sid:1000101; rev:2;)

# Alert su traffico da server bloccato
alert ip 172.28.1.60 any -> any any (msg:"BLOCKED-003 Traffic from Blocked Server"; classtype:policy-violation; sid:1000102; rev:2;)

# ============================================================================
# ANOMALIE PROTOCOLLO
# ============================================================================
# Metodo HTTP TRACE
alert tcp any any -> any any (msg:"PROTO-001 HTTP TRACE Method"; content:"TRACE"; depth:5; classtype:web-application-activity; sid:1000060; rev:2;)

# Metodo HTTP DEBUG
alert tcp any any -> any any (msg:"PROTO-002 HTTP DEBUG Method"; content:"DEBUG"; depth:5; classtype:web-application-activity; sid:1000061; rev:2;)

# ============================================================================
# INDICATORI ESFILTRAZIONE DATI
# ============================================================================
# Payload large encoded base64
alert tcp any any -> any any (msg:"EXFIL-001 Large Base64 Payload"; pcre:"/[A-Za-z0-9+\/]{100,}={0,2}/"; classtype:policy-violation; sid:1000070; rev:2;)
